# Lesson 4: 数据共享和保护

### 学习目标
- 深入理解临界区和锁的粒度
- 掌握读写锁的使用
- 学会安全地管理多个锁

### 知识点
1. 读写锁（shared_mutex）
   - 共享锁（读取）：允许多个线程同时读取
   - 独占锁（写入）：确保写入时的独占访问
   - 适用于读多写少的场景

2. 多锁管理
   - std::lock同时锁定多个互斥量
   - 使用RAII方式管理锁
   - 避免死锁的正确方式

3. 实践应用
   - 线程安全的缓存系统
   - 银行账户转账问题
   - 锁的粒度优化

### 实践项目
1. 线程安全缓存（ThreadSafeCache）
   - shared_mutex实现读写分离
   - 多线程并发读取测试
   - 读写互斥验证

2. 银行账户转账（BankAccount）
   - 多锁的安全使用
   - 死锁避免策略
   - 并发转账测试

### 性能考虑
1. 读写锁优势
   - 允许多个读操作并发
   - 适合读多写少的场景
   - 提高并发性能

2. 多锁管理策略
   - 合理控制锁的粒度
   - 避免长时间持有锁
   - 使用RAII确保异常安全

### 注意事项
1. 读写锁使用
   - 正确区分读写操作
   - 合理使用mutable关键字
   - 注意锁的开销

2. 多锁安全
   - 始终按相同顺序获取锁
   - 使用std::lock避免死锁
   - 最小化锁的持有时间

### 下一课预告
- 条件变量的使用
- 线程同步机制
- 生产者消费者模式 